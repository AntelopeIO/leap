#include <eosio/chain/abi_serializer.hpp>
#include <eosio/chain/resource_limits.hpp>
#include <eosio/chain/generated_transaction_object.hpp>
#include <eosio/testing/tester.hpp>
#include <eosio/chain/webassembly/return_codes.hpp>

#include <fc/variant_object.hpp>

#include <boost/test/unit_test.hpp>

#include <test_contracts.hpp>

#include "fork_test_utilities.hpp"

using namespace eosio::chain;
using namespace eosio::testing;
using namespace eosio::chain::webassembly;
using namespace std::literals;

std::vector<char> hex2bin(const std::string& source) {
   std::vector<char> output(source.length()/2);
   fc::from_hex(source, output.data(), output.size());
   return output;
}

BOOST_AUTO_TEST_SUITE(bls_primitives_tests)

BOOST_AUTO_TEST_CASE( bls_testg1add ) { try {
   tester c( setup_policy::preactivate_feature_and_new_bios );

   const auto& tester1_account = account_name("tester1");
   c.create_accounts( {tester1_account} );
   c.produce_block();

   const auto& pfm = c.control->get_protocol_feature_manager();
   const auto& d = pfm.get_builtin_digest( builtin_protocol_feature_t::bls_primitives );
   BOOST_REQUIRE( d );

   c.preactivate_protocol_features( {*d} );
   c.produce_block();

   c.set_code( tester1_account, test_contracts::bls_primitives_test_wasm() );
   c.set_abi( tester1_account, test_contracts::bls_primitives_test_abi().data() );
   c.produce_block();

   using test_add = std::tuple<std::string, std::string, std::string, int32_t>;
   const std::vector<test_add> tests = {
      {
         // g1::zero()
         "000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
         "000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
         "000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
         return_code::success
      },
      {
         // g1::one()
         "bbc622db0af03afbef1a7af93fe8556c58ac1b173f3a4ea105b974974f8c68c30faca94f8c63952694d79731a7d3f117e1e7c5462923aa0ce48a88a244c73cd0edb3042ccb18db00f60ad0d595e0f5fce48a1d74ed309ea0f1a0aae381f4b308010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
         "bbc622db0af03afbef1a7af93fe8556c58ac1b173f3a4ea105b974974f8c68c30faca94f8c63952694d79731a7d3f117e1e7c5462923aa0ce48a88a244c73cd0edb3042ccb18db00f60ad0d595e0f5fce48a1d74ed309ea0f1a0aae381f4b308010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
         "cb6c84ef58874b297a148a7d0d8d070c305444bae71188052edcc647fe820672b44c589288a3b06f6789d417ce6f4a03a57cdfb1e1d8a42a8aa4bea182879a59bd0d6a0baf525939c92b3ebb003a09d601fce510044c603cbc026d6029b4e414c2cf8b8d52465419c8151145898e79a0db6709589631b601ec15a0ab2bc1ebf9c9153be8da613c41e34155c703e96711",
         return_code::success
      },
      {
         "ceee6c9e1a6c228ba221ad93d4ad4d9e8833ebd4eab43c2279d466527534e693cab7d47c38fe5076527cabf553f7f0023c8fdda7c9a557ed67f00f5e763db42d32453b6c972c9730d62727ee7db1d942bd8571a15d5e7ac99c3f2638e1b05411b8a4a182986ddfe60025618808971865b1703dbca5b54534a798e75133c248b33b9865140c0f1c6ccf6c3b3848086618",
         "4a3f2830b025929c35ab4ca952022d894576c83c172a2b5dcad0592de56ccb3fe0d79173ffb7d9b3a9d25dcf4690fe1022b3d371c42a40922fad5f35d1425d19754b1380e0c6ab26ce5235bb80482c6f344d0282e9fd11d63a522afdb3653b02dcb2764444c4b40cfa8dd409e6ceab3afabd6edbce62fefced034fa86bf1e9a72f71c955d23a2e8cb88e21c59d155218",
         "fa9192b3dd85b569b2b3b7bd35f284b010fbd56a0e1f3fa08ec53406c237d3992888ef51c8db752d3ae401c9ad1dd80e114759044d3f0562db401fb338fa91a47d7ee4c8e113fb57b2fc42a7f595b8d49b35c897ef208ef16fd64e2dbe2db8029bdd5d6e8c565db6e1c404e47570a7a21804d3bdb2fe96411b5ab163df24e000bf8f5135a0d46e067ffa1745e89e810b",
         return_code::success
      },
      {
         "a955a224f5bfc2e6866dbd1c09cae3f2c9e2d68f195b642e765b0ade563c877013fcf97c79746ed5e8fe7ad6928ffa15b5adc82611544ec3ad79b715a071478afb3a851bd9c8b20011b259892400527ca3de3944c46e9f3c478fa5d3f28a89118b8e8784500c6dc1cefc4fb3b0f1f809876d1d9cbabcf753ceb39f6cf4a4b5e47c04c6d04eefadf8088c07790b110310",
         "f821e4f80f1e4f1d6011fbf07af24d377f7d6921b05c73ab6b6c8af8797505f3e9744f6a7c681a33e2f8815bf76aae16f975b623031db553e59e2f7d4b94721f90ea207cac7b7102fe943be6c66bd85862320c8749d9d319c4c7e077d2a5a31866e49bb81b7ec3a1a57e2d9a91efea6b22a7207ddccdaab3f3fa83d6eda3d7cc7897e56147d90cf4e1d70a9697552119",
         "9b0098716589d553634f4f21e334c3aed98f173334c94d99bf731588a897e0dc2e3b7bdd9efc01f9c724ab8d192e2c0b1360a29d087c97883e69976812dfa5d4d5892f69010e3986fdbeddb157e523c9dff3e36f94b769783aa041159ab0010cae8e45de968815a07911ac36de5bebbdfb3429a043128fbe766ae621699dea970adf2881d714569ae00a4fe71c71b513",
         return_code::success
      },
      {
         "8073cac5550abbe34caeed219fd7ad8a74cc93b89aa6a15cbe85d1bc802be24ec78009bfc80590071f62c736d42ae60ae4e59f83fade5bde522d02b5e9a3e3ba5a84f9d5112ad71db2e86a13485755ccda668c77c32bd21cc06f0268b0a2f718579c94e116c957ee7b67fac427c1d56cfdbaede897b4d430e7180d09a642788863b0dd4606ba32744494bc71f1ab6e07",
         "a4e870fc30c54c92d347942768133f34b30b8776b55898ae3f1938c0fdf2697bc0cad4c26a9f2c9c7b8c1639c72a7b185db7b401867267b05c03f819fac65683664d9b3efff1b0101c799347f75b3df020f4ec23c2665a1cd1376422d1f63f044f95e3f20bda4dd0c3a541283d8df7e9e8cc1175fcf91dc2d9fba8de51710bab85c724be4aca0ca375f9eb68ace8c413",
         "eca31649699faa52c0acb904f6b5ba7cdc9ea70c40b01e6169863bd74dee12eeb9f02929a4176c562c94dc9b1c68c70f67be02ec35a47c056ebb06f931cd3646dfb5e1e1d52843d7f23b62d84265e065f5ece47d182dda4b24aac8272773e906524060d7caf793152cd4c1799f638c5f7bfacbf8ccbc55b99b7c4c15b16089390ff550495c0b3d3de684ffcbd3c1bb08",
         return_code::success
      },
   };

   for(const auto& test : tests) {
      auto op1 = hex2bin(std::get<0>(test));
      auto op2 = hex2bin(std::get<1>(test));
      auto expected_result = hex2bin(std::get<2>(test));
      auto expected_error = std::get<3>(test);

      c.push_action( tester1_account, "testg1add"_n, tester1_account, mutable_variant_object()
         ("op1", op1)
         ("op2", op2)
         ("res", expected_result)
         ("expected_error", expected_error)
      );
   }

} FC_LOG_AND_RETHROW() }

BOOST_AUTO_TEST_CASE( bls_testg2add ) { try {
   tester c( setup_policy::preactivate_feature_and_new_bios );

   const auto& tester1_account = account_name("tester1");
   c.create_accounts( {tester1_account} );
   c.produce_block();

   const auto& pfm = c.control->get_protocol_feature_manager();
   const auto& d = pfm.get_builtin_digest( builtin_protocol_feature_t::bls_primitives );
   BOOST_REQUIRE( d );

   c.preactivate_protocol_features( {*d} );
   c.produce_block();

   c.set_code( tester1_account, test_contracts::bls_primitives_test_wasm() );
   c.set_abi( tester1_account, test_contracts::bls_primitives_test_abi().data() );
   c.produce_block();

   using test_add = std::tuple<std::string, std::string, std::string, int32_t>;
   const std::vector<test_add> tests = {
      {
         // g2::zero()
         "000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
         "000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
         "000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
         return_code::success
      },
      {
         // g2::one()
         "b8bd21c1c85680d4efbb05a82603ac0b77d1e37a640b51b4023b40fad47ae4c65110c52d27050826910a8ff0b2a24a027e2b045d057dace5575d941312f14c3349507fdcbb61dab51ab62099d0d06b59654f2788a0d3ac7d609f7152602be0130128b808865493e189a2ac3bccc93a922cd16051699a426da7d3bd8caa9bfdad1a352edac6cdc98c116e7d7227d5e50cbe795ff05f07a9aaa11dec5c270d373fab992e57ab927426af63a7857e283ecb998bc22bb0d2ac32cc34a72ea0c40606010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
         "b8bd21c1c85680d4efbb05a82603ac0b77d1e37a640b51b4023b40fad47ae4c65110c52d27050826910a8ff0b2a24a027e2b045d057dace5575d941312f14c3349507fdcbb61dab51ab62099d0d06b59654f2788a0d3ac7d609f7152602be0130128b808865493e189a2ac3bccc93a922cd16051699a426da7d3bd8caa9bfdad1a352edac6cdc98c116e7d7227d5e50cbe795ff05f07a9aaa11dec5c270d373fab992e57ab927426af63a7857e283ecb998bc22bb0d2ac32cc34a72ea0c40606010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
         "37ec381f5f912b9237c11a5bdf03d40e1abd8f20bc48aac510e13fe27af89e486f39cdad8832a008895f2465dd527d17d86142dcc3d150b757bcfee5f1268e4a30244fbb153fe246df4d0d9f165f2c9002fe6398f79481d55395689e8b15f80c5fc6a7c204882a60d0690ac3920c7303d1334c4366479b2c0b08d985db9c5948d4d2f94aecd9d25fa5e8065821e95a068bb9be510e5f40a65b956239971c361c27c0bb669e418431e39a56041ae44d30aae0c0bdc702bd1c3a4b6d8a2d349c0e025070110ca926c3134559779893752459a2c1a2d23485da4ea77b195537fb5b356a5cb48d9b931923dcfae44eaacb197cf3bee0bf0e5255433bd8b94e1a6e7e56335dae5625e94c5ec74e0bfd507c963317855760a5596598694e5d40890d0c",
         return_code::success
      },
      {
         "9fedb6819825accb2b8e5264f7751adbef3bcba87758591c12a886c03cbd6fe826c05400f81e9c19d7a2f59da2b9010e3907c8e6b13c6dfe3846af5794238ad10f6c91395b0831b6b7c5df1629248ea416fc71e170d071add93ce645226c4217d42cb9ffdd6f6aa7898401515cbd7a6e5369a0c1ca77e5bc0d92cbee10d79fc03ca30f5b7dac0c60d759a7b52c05440ab9e893411f57010fdb13b465ff73f9faa5b62d618a380772561307b43cfc1f50bc85ecf5b0efd166f6e4e07f699c7009aa69fd1bb6801e87dbe81f05f1c12622972911c675b613062bdf746f2e1b1c7365428fb9729ddaed8cbfd2661476a604cba42b1502f111b51b28aded1167a3c787f490a3fed639bdf6c3fdc25cb1b1d115b8b9c9fadfd50ea69b756834c09512",
         "d12fc1796c68ef3e363cf5f54364fb7178128678a1c656df751ac4ad739bfa3561bf8b156e2da0205db3196707d41d0126462a781f7dd6e6702a0db7c8429c149f0e59d70b303faba5bd25e2e6ef4162983f9ac0ee7d47463afcceceefe4fc0a7d8ecb6d009aecca3385b94f4ce81d36e3f4c69fa25b61df1ade3d49f3e7bd84058c51ec6c5f64b17f0d05db1af00d035f459a2c03bf6ac36a04dc80a3104ad5bca50b2920ddb16b96edc8513e1bb3c8bcd09cb2f9ae714579a14ca4ae4560089715b8b2a2f4283b0b9c0a3c686461d272e8b04ef21cd14766b9fbd6dfd61f59554c06ae52324d38f35b6e105dc94d0956a599c460bbc5ecf4c109a3e486e91ee553229818def0797e7b01f1ac861ce31b252cf4138b1195c0464fdefb286608",
         "034695efb9c8cafe81689d14ecc8e65623ea5020a07233ef095f84c07a42b8342661f9c872d98cdf41c75b08320aa41977198b14076b663a62a89f041afc1bffb5d2276060858cd2bcd8e004d33d935ea0fc4f823636c01da91a166e11126213f5dfbe35591acaabab64bb66124d28326a244b353730ce6ac05d940638ba14863e6e4c30b6d7eca128a53bcb5c648d173de15832746a29e4f0e4ad34b881bb08e0f9d2990bbc72c9bc6df1228e6e741ee1c59b2b7333594f0288806254b8c10c0352c80b6801b410ff9081a7041f4687e566ea7c4b29b9ffcf6dbd7a2c1fa7eaa65d912d84bd0b07453c5e1d8cdecf0afca9e3aec688e47dbbe43ea813476066181563481aa38cf25caa279f9700d7f79178f01c3e07cda32ffc4e01ea7c5803",
         return_code::success
      },
      {
         "7292b7047be950cb98766c6726dfe97f0cfd616dba460520db5baa542049dd0e864fcbb6c6c9081dd6d14fd80b71b91408e5b018076af52d9f581e3313a8314d3e28344dfe259924c999982ea7c5c99ae48a70123bc2aeccffb513124e86010309774bc4d5679f59114f2a8531ff0006315e4ff68429968647a22d40f6ee4711001324e966430a64a435691f69debc0e598d7a5ca0030bee06b92dac3f11bd0ba911fb660f065c53dabb529f879105face9cedab83c3707f0426c6bdc795d20e5529dba50a5831120ea15a003206cc09afea4407e76bc6e52b99585dfa2a420df52ca24ff34024bced3f0d0a6a16be17365152232b159c9cc7f8e84572780dfcce90fadfcba26337832b9c9da40872feddbde8d34af44eb64fce79f0c93c4e18",
         "6f389fffc75894538a6a529598c055b75b175ad4a987b7d2fd3559a96428edc1928e385175d31d0bdeadef15d6a86a0c2582893e61087ecf6bf2d93203d84b827da17ec5e415c20f81ada4835f50a12a28ee66173c06daac6c84ab052b725f192edd1105a5ed8761562492b04f1b73fa6ffcdb90c0545b93b3fc53575c9f523339828a2f155b1db7351d3f8665d83117450ee4c958940a8b7b916a98238d11e0d9281e8b7b48f1de3ad708de80dddeab0b164b1b932db9faa547ea600e9df105ab7611d2831139810ee3f7e2ee267978fd4c9fd8798b4384b49dd2b83e32607814b558697368ee4b133898dc0465f304b34e064ebd8d1dbc068d353a133bdaa583d494a1c7a0c2286e2c7aeaf4f1017ad93342b3e1c1dc9039b29ae3bec2e210",
         "01b6280399256c33068a03316de8793f0b3b7b821440d0eae89698f1bf3ac6339b1bc4d926ec46b3e69e2dbb01ab41155cf70c836d595e3a1f316cc4bda8964c6a1918fb53d8f3086c0d7a557b3ccbe6cfdbdf240646b8b0ebf9e5cd284f4d00c31f1beedc5441afcbe931f7b588bff2d47383c4459aa05f2e0a1f47a128ab8fa21ade44d77d69448241c35cec0b09030b9c999b9c3ee3b12760c4191b533ed002b131d64774562a61dcdd942d6d192790fa3c9ab9c2799a706bc4b8e4489c0f0792f6014ecc421bff98c14510ecd254b1366c899f38b9fe5fe272645cd8afa820540bcd96825218b5f605f0cea2e40f81d6f59144bd82e2bfef4f9439d2dc8c283bc5e49688e62d0d27470c92584572bb676ce1973e870c4a2d528267730f16",
         return_code::success
      },
      {
         "7998f27e2ae8577e9f03dfbf5979edc189e4499df4046b256ce4dab0ed9b71e6617e894fb40d0ac15d166f2e28a75e11fad87fe49585b3ebd75e2efeae7b9987595308fd4238d917d3281ca751b2efbfccbb0c261f28e3696815270fc6f6b00addf860b1a7e863edb17e45991cbb25665a22e9a40e3fcd58aa875b1fccd4d2db3c446dd731ceac57e7bd0f74d2c40b091127ccdd7bebf2f5048d193b451d8a145896bf48b4c053ff99ff1e69d47dcd7b0d98e9d40e89b00cbbf99377d63e5e1887c76b8d82e7843e25bb6bbd16eabc1c17ba0c0adfe0599f8aac7519e2b78df1085eaa33c088b4318e84d49f5fe9f50cee60174fe4ef7cdd24658f84ce3ad6d08e65050d28df66fca6139c8fab230147af1820d50fdb1804dd6f01290a395811",
         "91462e5b83b18c62a78492b10e4c4240118400398c85a07fe7c1ffc4d78cf3a6dffe717a4c05331cee49273a1350a71714f0dc231a91d3d687e65416ef070932285facf8a13c26d9311cac3a494179facf6b623951ee749da29b32cd39ad4500d94ad0c0b4bdc8346c4ea9ae497b09b31e356f75368249bac0c49e6dbd20eaaedec624ad8971691382e44fb00bfbab00eff738c3e8ccf3b0c3295d49adec69a1821a38c7ad8b06ca87c66ecd63fb352f1b254bb1dfcefb46a56a3ebfbb745a08fae66f083c8cc37d379cf8022ea3c87a6aeb747d38f7405e04be72fbec8c99e5475321ef4adf3219caddfd4d2558b013eb05f346b180876b4886bafb43d29b0d4cf99fa76e49184818fd26570f5bf98c53f9266ba24803822e6abb3996690402",
         "271c51bbab23e74a87512782b502e2045745719850222b88b3e74c2827d7e157178b8221f95e81e0b33c37eae451720b2602fb54f74fd0e9616c23ed01b700cb1635eec16182d83fde3063c505d1165a2e9324eb83a6f664cd75b5aca1bc9a0d6d2f0c65e6747b83e98a781fe4172e73d65ff02f76ccf6d3a3a888fb7a745bf036be4124d4d4788829ea96d4131bd70114eeca364293d4242d9194e71a6d3d51e3ff533df81f92bf1ff1961f0ece0243c1daed01e9a7effbd08c7abea2629b13b0de9223b4b163eefff5442d37175e05d4d0116a497e4cedc01adde05399a875bb194606bbe8ca6eb191a456941bd51353f9cc531690aeb77be5a6b251cda55bbea3adf833ef4d5290226f82a8e7c272730aeeac68ad55f0001d2123848b910d",
         return_code::success
      },
   };

   for(const auto& test : tests) {
      auto op1 = hex2bin(std::get<0>(test));
      auto op2 = hex2bin(std::get<1>(test));
      auto expected_result = hex2bin(std::get<2>(test));
      auto expected_error = std::get<3>(test);

      c.push_action( tester1_account, "testg2add"_n, tester1_account, mutable_variant_object()
         ("op1", op1)
         ("op2", op2)
         ("res", expected_result)
         ("expected_error", expected_error)
      );
   }

} FC_LOG_AND_RETHROW() }

BOOST_AUTO_TEST_CASE( bls_testg1weightedsum ) { try {
   tester c( setup_policy::preactivate_feature_and_new_bios );

   const auto& tester1_account = account_name("tester1");
   c.create_accounts( {tester1_account} );
   c.produce_block();

   const auto& pfm = c.control->get_protocol_feature_manager();
   const auto& d = pfm.get_builtin_digest( builtin_protocol_feature_t::bls_primitives );
   BOOST_REQUIRE( d );

   c.preactivate_protocol_features( {*d} );
   c.produce_block();

   c.set_code( tester1_account, test_contracts::bls_primitives_test_wasm() );
   c.set_abi( tester1_account, test_contracts::bls_primitives_test_abi().data() );
   c.produce_block();

   using test_add = std::tuple<std::string, std::string, uint32_t, std::string, int32_t>;
   const std::vector<test_add> tests = {
      {
         "000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
         "0000000000000000000000000000000000000000000000000000000000000000",
         1,
         "000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
         return_code::success
      },
      {
         "bbc622db0af03afbef1a7af93fe8556c58ac1b173f3a4ea105b974974f8c68c30faca94f8c63952694d79731a7d3f117e1e7c5462923aa0ce48a88a244c73cd0edb3042ccb18db00f60ad0d595e0f5fce48a1d74ed309ea0f1a0aae381f4b308010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
         "0000000000000000000000000000000000000000000000000000000000000000",
         1,
         "000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
         return_code::success
      },
      {
         "000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
         "0100000000000000000000000000000000000000000000000000000000000000",
         1,
         "000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
         return_code::success
      },
      {
         "bbc622db0af03afbef1a7af93fe8556c58ac1b173f3a4ea105b974974f8c68c30faca94f8c63952694d79731a7d3f117e1e7c5462923aa0ce48a88a244c73cd0edb3042ccb18db00f60ad0d595e0f5fce48a1d74ed309ea0f1a0aae381f4b308010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
         "0100000000000000000000000000000000000000000000000000000000000000",
         1,
         "bbc622db0af03afbef1a7af93fe8556c58ac1b173f3a4ea105b974974f8c68c30faca94f8c63952694d79731a7d3f117e1e7c5462923aa0ce48a88a244c73cd0edb3042ccb18db00f60ad0d595e0f5fce48a1d74ed309ea0f1a0aae381f4b308010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
         return_code::success
      },
      {
         "56fb700d759b661cffa9e350aec51d590585e0ceaa8c1a6307bb3f4b5f9f6c99876bc0438c0855b9b6556acae04c0900b7a7690c60bfabc1fa082f5bb22bda7388bd3a14b55ff2c76587dc853a14585aa5216fdbe248b70b9219e3006ffc5a1561c571dfe71a8e423551253bad43d887b5bf3a93956c6ef1bdeebea6bdde14b947c402383784c57178fc83d9f2dc240e",
         "bfe41699bd50b1461f6adef26ec1ac3116abd97b42b9bf0d44aacae55ebbb771",
         1,
         "51e0871837ce0f9c72f1f0af031c7b9624ab8b6517fb012829c99fa0ed145bdcb01fa238d63811f0648eed778cb2cf174e439855eb15ac53e6b1c4064f34c4e538e5a066e6da61edbb44915af9294b51ec8bb286403b027158fe8b6603edce0e7dc24dc0912e3af82f1c9167827678ed5ec4180293b9edef01d8b9d6f64ef1a2a4afc9173f3767f5c71f109dba234602",
         return_code::success
      },
      {
         "56bcd8ea8d9addbe64cc09200e5d562a892a772c019cab467f0ef941a279ba13be847f1284190419ef4dd0ccb7846b15cdbdc2302cc83fa9bd13e782850b4273b3c077d2daf86e385691d96b878343862bba44d61406f2be3516077bd344930b18f61d751a8745ed6dbef9f964430b35d4c984d77d136d84c5406a9970a92d70629116af1305f983cdedfd13931d1c0e",
         "3a8e9a6c80c65b79ea9b84344e8e4f3bd709224c3eb2d528313cdd73427d5a37",
         1,
         "9e0fbffaa16ab6c0f8dff313e8762cfb969da49064c9e5e1fed51138d6ac994d9e925d34d85f43819a9542a614724d104c7063e4e4d964c7c45ee327499b0f16ccfb851fbddd6e1ac3149881e526ba592528dabb7608be4c4c2fb0807344130824d348b88b72e4e5032eee3e20bf07096a414e19f701a8aa0744d005a8fc686ccae172ed6c09842c49f37c3f5e9bdb17",
         return_code::success
      },
      {
         "a6ab6ade9e58a67857fcf69bcff210e9b40369144f7dcaf00dc46c43f7ab7e0f233d8469279daf1a97b20e5b817d6108a9cd276fa9e6bf6d2112066a91658de928a971396835782096e9c1cd75c3c0a2a917e433f2ea36a5a1edd5a22c0d390b635fab99620b983e87340a8238307608a7c5221d6760ac3122c4b1710555b3d5eb4b15b1a43e238b8e85e9e885c6ae13",
         "4efd4bec47d91858f9328b5000e5d4028011a5b9f94ed8106541878bf1976245",
         1,
         "7671e871c42d00b72a9a2cd3cd518c9e9c7d75ed889787287ce5e3e2b4716474e9975de5f0431aa06aac2168fa9e38114b8cdad6cef8e88a319bd0a982896e392737775b5114250e4fabf180351433a75bc33497f514be84e437f38bcef4b6164e1bbf94a16397a17ce96861bccdcc5b538fec20b53fbe35c6f48853d3ea10e22c656c53c4e15a0ac638f74f59f50b0f",
         return_code::success
      },
      {
         "dcb618d46f80506aa4c8b76ccf68a02e3ee3d026e49f6af27c137e642a913c194348fd4b3b5e820de212e18adfa0d20df96e68b55c29b475b723b1312f63b8aa0aee12b43401daae8feb9cf4004c8ffe373804b38f62f874d5ce4cdcef27fd0ed652d3e187165f3ed4a440f9c51b336b5968a7e91d16cd01bd360c318c1d54bf67d1221b2ab135f809df3a7778eb0011ab2c896d7cfb17c5db7095355e4540a422c298db6ce1dd85f2f3482408747148bae2dbadb5c92421473c7700e3b34b05e32d691d3c66c243926ec8b73c62af21678fa25eb724e50b5e5056215c0db74ee65bdcefef95b79d55419d1ac65ca704062464c6bb4e8ab5b386f4c7878d2c28b382b6a16eeb2a4efa9a69c70b652e6912f9524e679291c82c5f17f511551416ced99e93d6990082ada3f6857430bf36ec3ff672a21352d6d45072298097ec67b67ffecd48bed86cb800d6aea9d83e049cc3a6b09624f22cc5e2d130214e6a6ab846de8f5cece965415a41a955a1b4c694dad48571812e9dc099b5157298d9139dc267eac3e1d1390c6630dc870b6e684a2fa76469a8f5ec129552386f4a1cba1bbbdcbb82ae516f77bb2f78b82463182accfb2d4b291a4aab60e58d88d3dc7adc575564bcb5de03bf475b37701b27c55b6dd829409564b521680fbee3edf41102e2d16d423925870e3a348de97a998ecc393a25db64a89651a2b86d61a09498b1433a5fd7d267b55a43f77c3030760803ee7f6fe2de530e982ca0d4a1d929ebc21fee5d72a8e77d428c01dbaf611acc3f5baf3478bd458c78e167a5a2ac6a18",
         "eb4838b85a7fb1915604457d07dca331d081c4e960e15b1c9e264c26370dd22ffafdef177ccb0521114742e579df2b392d26259622de6f13f8f4b8ea8d608305dee0d12642aea8997d76df5bd95872412cac12e313357c07c4f0c561526b525eef1980734b6a920f312042b58a84de104d1543c1f03c36266b389a58ea969116",
         4,
         "ffc9085ff3eeae99e94cc295baf1015167b938947e030accbb0530cd83d968e04a7331ee358550385be31015c44ae40236aad3e318831af99df4df46aeda1234ee334b10a4132e1edb4d4405e943ad051a67677af79b6c4152d3189c68a6880639ee15e8dcb151b479dccf7d5fe20f697195f7d724ccebfd8d95105bc047b5fa8a65c816946634d2472d745ac2cec902",
         return_code::success
      },
      {
         "4d06a8c835228a3176bc957ed6b5133efc08335cb45cb6e6ca10f62465718c85ce90002880588bd97914b6900cb62f07897722ec89f1ed966150c6be9791d2d45668c0fca36d3ec396c0b2d13287e9757a0e32bc70ed761ea9d4f3acf8769f126c91af6d593bfa8d04b2932a119d247277d4b2525ba94375f066f523c907fc016d555cbe4012477016bc4d434144411686e3596064845305fd8528d5d3717eca505b970bf933d3940d6a29a8afd35d257b014a15aed0b63de3450035f548ab04ec8394201ff8d4bd92d73c9f4d548dbbf9998b153453410e8214032a4f47282a511b99a6435c8a658987be5c84c35603381c5e2827425173da2b54ec8a1efc171a65adb910217e61731722a79b40acde67c1425d5dafa2edee49522afb26c40200d18e138a6da3388bddd5463d2521eeb2c9eaeebb6fc0c63affc2b1b7cc678d7eee2891b74fe7ad3e620a24f5bbc215ae1b2584bcc71946e4bcc00e8a91508f331d15b19c9f50561e077606e8c56706f6bb98eabc2a63c96293a83472b3b005690965bcda3acd44f82b654d5caca9c521f93113badbafe5fb50f51ddddd40f1c262862192c5d147ebc2b82b771e4d179e46a84a1d31e9f219c877f6dd77b3a784f7df5463d042304d6e889d8acd8003fc9e89ac96b48f561bd15eca654eb111a94ec406881b6fa331fe61cfbec2fb2322bcb8ac7c5ac7136ac1a811363faa6a37a16aa2a6728e4094ee6d2a395fd509663b700cbef78b70c37ed463aaccad738755334bd631889a04310d666cb3f7db670e3142457c952183501cc7a8f32419",
         "eab5f9ee6fb7201cfad81ab70971aa2aa4f0adcbc23a21215a7fed3dc19474704157455231dd4772a632c259c79fa22ecb94480689b5f6251a6b4fb69d29b12cc6bd2ba85ba90c945af4679cf4989b30fd0b89335c68971d86390c2af5935726e79f59dad66f0d2c0262469c26c1bc02e5c4c9a41afdde3274f96637523db65d",
         4,
         "8cb62ec44e75e49f6d5e2dc2bfc4bd5e472258cd157050d110b73d71880153f5aa56f82421575be902ea4c2f76b6d301a56384b237465fc44ac3a75e60448894bcc946c5700dfc516acf5472de583f2e662cf941f12f509895a762dc034f980d415b35f0fad0ddf3d1ccb98e887b1b3c1722e31fad62f53dbfc844899a7ae44369154b109ac03a258da7bd71773fce19",
         return_code::success
      },
      {
         "20d1735dcc2d5d41c216c4454a1eb76f1356cdb8db2ee5d20cac5664b7193786b69afbefe9acb627a601ce4a41e0341642a975aedfd479e5fc395bfed5e6f59977ccb721fea6f27e41d494d8f6a570b3e771102f963282d53e4fe0077cefb505a6727dc3ab58f011eb3e28f8333d8f679e8f99077ca57d1f4eeb9655f91c8364d09c1cbf04bd38464c3101478a7b820015ff304b751a4928160dc69d3a54619c35206808e03fa205b83a29ff4dffbed65031fe49a9adda364c029c59c105a518517e780fc252a7e2b55930dccf9553d6952364cd93ee3de6efd2ae3a29bd4909d41b20e628706ec03fc014f2e14b670c0091140201f70bc8dc4282ab700bacd77a4303158a74583776d0ea6efb3fe60c7daa4b684ab0ddd88bcbdb3357a6db06d63612d32b131f84aaf04579342f70d8b469ea6a37b31ca859d8ce65ae3ff9f1220cd53e0dcf48e45155c47ff793080f87eba9dd36e82ceab065f5a80d68118c77493735dd1fa5e18bc046c692038509f4e05116e1e2627cc886e1296f81f8030eb2be70d61acf208fb9d294840cc31e7d44a4944e8dfa60a29ce0521f557f80018bf2adece6fb22d4ee5dbd39f9cc14ed384b5382c2e288b5454e16932b79eba69085bf978aa1e3c0a9a1fcf85643152910c5fc9bc8e79b89246563f19f2e1901aaa41b3d6b93a599ad88d7050ef7f6f01ff75fa94e46969e1175dcfec3e586a409b2230b4ea60cb1d512d98483c61984aec7c14117c471d62de392dc7ff6373cc01ad7a3542607889ad4a83a3cde18abca6fe37f228e52d61af48d0dc22510",
         "ce6d7b7ed8e3ff3e93d51ea53e8ea94872c2a2f684175501566e651c2b037b0f49b2d0b4d2a5ce031fa917b393b64a2196fd6701d071662077d8bf8d0d5acc5f1c68c234ca67dd0ebd3777753c3cad1b7550b3d9b462630eb9b5e1f6061206466eba81651bf5959bacfd314f958b02430fda49d060dede0b1e328f916ebd0462",
         4,
         "42068b82d2fad3172e12b1ab84d2453521a1fa1471ab898fa61805aa8e3df69606e0868af1ae00da3b4498c835857f10e1132fd7e787a67bc6487e4a96f1ab0d3b6a7211cd92e8c12dc0870cb07aa5a545369644bd27d0a934c3f68cd5b89014e2c7d32789b8618b7e8747fb2cb1534f16987395ed79f6c683365d9978338a0f7edff04133175859f1081d126a818a06",
         return_code::success
      },
   };

   for(const auto& test : tests) {
      auto points = hex2bin(std::get<0>(test));
      auto scalars = hex2bin(std::get<1>(test));
      auto num = std::get<2>(test);
      auto expected_result = hex2bin(std::get<3>(test));
      auto expected_error = std::get<4>(test);

      c.push_action( tester1_account, "testg1wsum"_n, tester1_account, mutable_variant_object()
         ("points", points)
         ("scalars", scalars)
         ("num", num)
         ("res", expected_result)
         ("expected_error", expected_error)
      );
   }

} FC_LOG_AND_RETHROW() }

BOOST_AUTO_TEST_CASE( bls_testg2weightedsum ) { try {
   tester c( setup_policy::preactivate_feature_and_new_bios );

   const auto& tester1_account = account_name("tester1");
   c.create_accounts( {tester1_account} );
   c.produce_block();

   const auto& pfm = c.control->get_protocol_feature_manager();
   const auto& d = pfm.get_builtin_digest( builtin_protocol_feature_t::bls_primitives );
   BOOST_REQUIRE( d );

   c.preactivate_protocol_features( {*d} );
   c.produce_block();

   c.set_code( tester1_account, test_contracts::bls_primitives_test_wasm() );
   c.set_abi( tester1_account, test_contracts::bls_primitives_test_abi().data() );
   c.produce_block();

   using test_add = std::tuple<std::string, std::string, uint32_t, std::string, int32_t>;
   const std::vector<test_add> tests = {
      {
         "000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
         "0000000000000000000000000000000000000000000000000000000000000000",
         1,
         "000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
         return_code::success
      },
      {
         "b8bd21c1c85680d4efbb05a82603ac0b77d1e37a640b51b4023b40fad47ae4c65110c52d27050826910a8ff0b2a24a027e2b045d057dace5575d941312f14c3349507fdcbb61dab51ab62099d0d06b59654f2788a0d3ac7d609f7152602be0130128b808865493e189a2ac3bccc93a922cd16051699a426da7d3bd8caa9bfdad1a352edac6cdc98c116e7d7227d5e50cbe795ff05f07a9aaa11dec5c270d373fab992e57ab927426af63a7857e283ecb998bc22bb0d2ac32cc34a72ea0c40606010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
         "0000000000000000000000000000000000000000000000000000000000000000",
         1,
         "000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
         return_code::success
      },
      {
         "000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
         "0100000000000000000000000000000000000000000000000000000000000000",
         1,
         "000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
         return_code::success
      },
      {
         "b8bd21c1c85680d4efbb05a82603ac0b77d1e37a640b51b4023b40fad47ae4c65110c52d27050826910a8ff0b2a24a027e2b045d057dace5575d941312f14c3349507fdcbb61dab51ab62099d0d06b59654f2788a0d3ac7d609f7152602be0130128b808865493e189a2ac3bccc93a922cd16051699a426da7d3bd8caa9bfdad1a352edac6cdc98c116e7d7227d5e50cbe795ff05f07a9aaa11dec5c270d373fab992e57ab927426af63a7857e283ecb998bc22bb0d2ac32cc34a72ea0c40606010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
         "0100000000000000000000000000000000000000000000000000000000000000",
         1,
         "b8bd21c1c85680d4efbb05a82603ac0b77d1e37a640b51b4023b40fad47ae4c65110c52d27050826910a8ff0b2a24a027e2b045d057dace5575d941312f14c3349507fdcbb61dab51ab62099d0d06b59654f2788a0d3ac7d609f7152602be0130128b808865493e189a2ac3bccc93a922cd16051699a426da7d3bd8caa9bfdad1a352edac6cdc98c116e7d7227d5e50cbe795ff05f07a9aaa11dec5c270d373fab992e57ab927426af63a7857e283ecb998bc22bb0d2ac32cc34a72ea0c40606010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
         return_code::success
      },
      {
         "5adac0df5e3a282dc813364ca18c028415b95dd9df9ac2f860d0fea01ce55f0a333269a9fc54a33f65b8f4eaf4141a16cc266f7338ce5173fdb1360694781d56125d1f68e343f59261d085de3b80e476d7e9270ad17890191f7d4f4160a49f03960b00664c707cfb02239df75d2c416b5c68b4d9774ddabb97dc0376a0b33d8a9a1cf9b96481cc88dab9ff9dff50920cf5d21c888bd669557ca8df124a946a30e29dca2225186ed7373672cae29b7902bec47f4672347c24c604bc033c92320bede4ffdacb11db324f51b6bdff7427e36914e9e80e5743a7f63cf9129b3eae2d645b04a3540621f44e987b6381e07f17bbf46da4c8a39a1c6b6759e713c5cbb0050fb1308559d1bec6b8f6a65a2315ed8b0bdf5c3e60ff4a0e63137494012809",
         "3037b50b12f5c9442e9c7fe9c543f348f5f6eb2de2377a1618cd18d9885c386a",
         1,
         "18e97db707a56e5c0a0c399adecbe8124772d84abca9d28bef8303883fb9223aaf92f68cf0bbe2ad73d18ad014971e12d515e87caf346d7aef3a34e7d0602785af3ca8a3d984564f88b84f35fbffd3543f9c9fbf04bfbc84b9f20addb09ff91873f3e30337e191d6d8c5c15431cdf7453cfd06231271c5adf597b8d73f4101d9ff5f5970f1d76bae4b15c9f9b8a7140f3d6716c173e08f6ccfc34c50698639887a1301cbe19c942a60b6ee163fb142bd4400820a4eb8b23c55942be7bfabce0778697e8aafe4d613d03075894a19b039593b4816c995e370e587ffb85959c3569939ab809af8a0fb12ddb9347a81da13c63880e64365d9702704c90cd2921eb30c3c470dc773ac32c0eab89208b9bf7567eb4c797ca128accfa01c5388dd0f03",
         return_code::success
      },
      {
         "6d0daf59e2b7e50e4babe8e5e4690eba3d73423e99dd3ab129d32d7904af3911f605a002ba2f48f91932f2d2e04c6602920210df256b38e52d6503c8a4e5957d52d47b49c82b37513b2bdecb0c1351d3eede4bb50660b48307543d3bb2fd000f243510935fee0164dd30650e56bf3ac128f3ce4b402eef0c29a80b9b0f334a7d9f33b5984d489a1d30ddbe845c424104679e987905f549297cf52b3ca1514c22757d6ae50a50b402ec77b69d6f0863e3e8c98bd0e01ecd23ae0d721f7a230815976541b40cb3366dcc5273e5644c4cfa4f2eea2f1d386e74f06f95bc41f9a48ee21151f5612b7bbe3d15e2e715421911da5b9bbfd8a5c4726d8ff91b1e071eb7438cfa6dd6f96b1d7ba83fdb49fa6b37c51f4580669e8d02647c932f1e2edd19",
         "3ddc7cc83f77c2c955f9b62b7a85e80fe0d8766530bfbf26e3c95b47219c1114",
         1,
         "2a969fb7f284c4541faf1eb3377df4abcaac8a7f3249ef4551dc15b10cabd1bf2bc2a96dd236d3cecad81190e16ba41002d17be3ac576f5bfd9d707b07db3f6998bcac664bd1e2748ef73a5d006be33880a81ae9739eb7d2559bbcf75d339100c93e170ec7e792fd6172f87ce89626f5bfa4801dfdab4975f0c974cebb78516ca50313c7e7dd8ad817df4e6145bbc6167a4ef11788579968b1dc9e3af2264783abb93e614e4962e9cebe93b0fdf80046592cb907a9a78fb415915aec4223b60dc7c3b9aff719548b347b0cb2d5b723f98211e9110b459224c85f285f93f0faad9356610c8ee70b97d863fed55c036016a44f7f1f43fd0043a93ddc42ec5f4456f61bfe87840395c2ea5525b80aa366cdbe3a8b65d98861d0ffee45085dc8c608",
         return_code::success
      },
      {
         "7bf7545801564b8ee91322690f6495dbe6d97775dc1b016d4ef381c9de8aafe3d9b59144065400978635b3f0ee55df0491478d53799662535ca8df5a3801ca08d0425cf0ebb1b7b0ef8dcdb58786b739724d45eff00a0bd4096a9fdf6df7d200d1c846443d604460df8d965c4e6459e2eb70737c5713400ad43aca2cc29f0948a5fb51d33646ed2e10760d0f33d7400d0821a5527a7f8296645b5879a208bbdfb647b5825e0b5fe50a5ec2cff163bf5357fd7abc79c9b6930d64693716ed2d15a310ef21e1fd5e64cf781ce0ee47ca3762fcf411d9e9dfe47584bcc8462fcad208cfaaf9c82f1bdfee2fa3c99d6b2a0e751e342db7cd57c0e1416f0f1cb3e2d23971d62156d962be56eaf937c0190f65f4fbf345dab0d5fef594e46d73c71413",
         "3e6840207347e51e921476e0c5890201169aa46aadfa7408a94063d94826d70b",
         1,
         "9c91de3ee8b232de3bd146e8b9b6a16ea3ad7c02e962ce2a50c542dad854b2efdfda991643dbd8ee01c573052c83f50394da59183e16ba56ea1e16023f661542e989f85b901b88cf39fe099d8aecff9fd86542252410ed3377c93b7a6315e113bbc5cbe103b3dba29c5b25b77ca827a15a38c3a7701dadc9e1e3f6558defd3172a97564f807309e7bd275c508974380b886dcb2ed9dc3d5c62a00d2e84855ebe7399d150416e69a8ca953522b8da8592b216fc7e49e614e792cd4016cbf0e103b3b3d8ae164b2d2a58059829bd5914977040dc3d0e4f374568e662033acd9c54c14019f71ae6c7c4cc333d5b6dbb8215ef085b3981b0b5409a1090072e2b50283741d573ba4c08e849b1101890b0190f9b49485eb99c9cf9e109d21a88a1c806",
         return_code::success
      },
      {
         "98ff63938319e13beb5bae7d26f54f7cc5d639eb7ae207ce0d1d3d3f480286c0b83acc6692354a55fdf32e4e737aa8094e2081bf5958e4599da575e28e29cf17ca35cc6271c8ccf93341f39910cdc5c5431ba1fafe780de241223524b0cbe718669ae90f424f963be8509e56dc5197f24e732a80c2e5b761a754e8f8c73e35c0c7fcba00e7add9509d86c5529b735c18d88c76c7d7911800d05a91ab487fbb1578dcb4488c36035df08fa1424b2a8147894bfc86eb4dbd92a059d51f980acb112a7a145d317de527320444e2ca091901824e24202acf199a06d56774fbad1fef47c3516a415e88f374bcb7dafc58090087e09c28fe2228be0221afe6cec3cfec4406db4ec0383517a9d1290590729ed9a557a3fe2bac0093cdb0e6778560b91277ae4e16116167a9411460635e349ba1da161fb122d962b3bdcb773b5dbbecf0cd107f9f12d605dcd0ff834f558cc418b632249f2c3c54320f677cb1d28207a42b83bb13b2a0b30cc41f33f29d5f960190854671b1ee1f25345152155fb8fc13daa09b5911a10b6884e80de8e9ff1976abc79f08cc6b0be2dbf49b651f46a8f344f3b832ce91bbb82c109236fd6bb206566e449138032833c3c40754f19d294f04d9ac2d24948a122209fb07749c2887a10baf417f110d6ce6cca80daae3e7115fee2cc7d70cdabd811ff78e7250216ec739311176c6dfabf3b53caaf66a0528d17d4a382ce1802b7dbf801740ccf813499f5ca7a70ca5ee9a01e874e267032ead1b95046850b1cade80bc06e6ee5144c520b5a2b7d7ecbe400b9b6e77e1360920f0502f3d7dca0558239d634f399f9af8745c6085f8a894233226e385b253ee7f4038f5a42755ea61606d219e11e70321b48827d87d5eac14f433a0638e536ce0eee04a714e3e6b3c2f57d5620d9ac51b6b1663abd099cb3faf9be52eb30b15407aac7ea561b47e6967a96acbdb42690ef693c6d07934fc0b4f17e04f51ecdc8915e762ae4dfc151178f06887ec6518f706001f0d50827bff24f0ac16d2d326301b111108b35f1b98b2688f6c327a65ed0ea337851d066754d531d51fca7412f0982e4c4ef21773179f24997a42f8a4d6f339afabd999256debd612450539d0cceacfe8609bb6be7ce7c594ddc4190adf70dc877087185bfaecd62a5b53d68e4b5e3d2a143cfefbdb4bb639e856712f0f5eecfd8ffdd6ce08684edeedd6e00e59e779485f80a188efea52a8a0c9d7d63cdf32f9366629a059a997323ec561ce0e43011e498977b1359763e4db72f5078946d2a7757a1add988d9d81bfdda48a30cdd24be7fb010e91a82ef42b266849b513c62445cc0b58e54cd20b389889001291f455538775c3fda0f9b0ec9c875f9a9906c4cb4bfa68ed1300fe62682c1a217912258ab3026f4fad3822775751083e36f8b41c6fec90b23b0a53b01509d14298c11a4f2da42dc3002a5429086cac69346e98015f0641a55f87ee8e62241936c38d125cfed2f240d25d3ce72efe1aa913020d1de74555b0cfbc494d6de29eb09af18c2c89e77ab461a2c9f7015111283bb4adfa1c08c3dd0f3850089128c04859f140d31d1ed22edabb7235604ed8056a5600f7f1c09a1a8eb296f6777801",
         "48a9410a2a1ece4c2060089d43d5823e050e7b37cfe62f1c1f02eaba0c4f65150245659e35fda0a14c2a9e8b28d08553dd25445522924f1f6d91136c630a08581980e744c18ff77fc5d5bcdf2d88da37da96c874a3154a023b2435ba7c40b6552900c95db9c62446cfde76bfaddce339852684ccb18f6c0ac737020c339c0346",
         4,
         "b8e6b7bad865d19f191d25373c675d3f03cd4041c5b84b1832ec9cc9ed1297511025a1292f84d8afc2b9296647a3ca16502ff327965c37ae9d233f90f288d670e8f4b66d7ca8496fd7e09a0daceb0d93cea5a178b33507d9d2cfeab4580a1b145beb7ce5a0990e99759eedd14e601cb0ddaf478dffc98a87ce4705b98d91ce3f1d7f6322dbcab5e27057bc28c1a0f60451408b08d878bca1f2afead2921e1f9307d9c7c50ce92bf9727c0f375e280c767097dd0857151a8aab622b3dcaf197156e43a53e8fa03eab5bc213d217045515f62dcd5c68ae8c180afac5eabbd20e4f8052db79b6cb97276060dd16af90580d36a142b7bed1a8a5e8aa06221251ac9753d223c56927310566650fc55607610e170437af34c2e3ff493fe55a69c5dc10",
         return_code::success
      },
      {
         "75387ce4cf7b8472949c128e1418d38f4932677db207ccd28d1c6a498bc24ff91f49d69c991c6ae3d15c26f761b51b0fc46bcaf260173a59ba6e7eb49ba671a3d3dd587313b43bbdb6be6ab2d469d77c6836d227f1116261191eaae3c93b3408e7b3026880a98b719ff2f45a334384178850aa666db9ef17a75f4ce6144cee080bdc0f5defcf6549ddd3bbe275a00e11dee805451b1d431b59bbc78eb38aa00e8f9bca043ab92c24f05a252949e33d4ad10d90d38063c4a73a2551a1068bf613ade87482b842f06d93011563cd8b5fb860883ccc23c78845b28d641a9adcb30940ef5ee1d022f1414946719ee913250378849f9e4bb00304773bbd1109f79d37bab2a66d36c7d48f197d2ea9b263f425e8bfbb360b327793362ed75e353f7d04376b535cb824137ca6d40ba849d5e92566173d520f5a8cfd838266c90d80625dc1b78df6fed60c51a524cba5d74b6a00628adbe7e90d92e601946c166463f24e8d5508154265f5b1be25ca100e6db502a65681c1cdf6d9a922b1c373f3e2fb1967a4d5753b1a0a6ccd6430df5ebf2a1dd663921f0ada568d3fba68e339925f9f520649557cc600cda6bdbb30fba7c116705ee98858b3d0fc8e82a70587b21579de3dd175e8d252ef3a8ffa1f9b559a57a012c880102a4289250438151e7f630563910fc6d5b053a0d843149afad7b637dd851f141422aff972a9ec383111733153fe5d8fadc6f6d37ee872595c4bdf144067ab39dd736862cebcaba1d599c02af7ca091df1eddd30f901c8ad353c04db07c3fc2c31e9279f2bddb38dff85ac0c59bfd234428019fdf7c935a8db5d4cbd4f8c99abc077e805efd729b67bcc05bbf419d5f1cd36268495d79c258a8c0207f10b30a54f3a291499e22ad20c8fc6d0583b66dadaab1c14f2770a92b134b8b257373a4cb3f760bed88aa50174493b1817aa16bbf5c5e9994782d3ad7f1cbca4c4e870398b207a66ded6350dbbad80812aef94e94391740f72bd9910209ed200542bcd5d6b5252008f7d91aca39c05863b0605d704da2d19427275916c763d95837dbe7a8feea999ffd760fcceebaa16c37789b67a9e0754e0aac7a842fe5421a6fb204315f2ea61ef6da436dd16fe2b83f5ea035a40c0dbed588e300b8d4a08176394da6e7dba73097123c2b48017a462ffae48835908d56314faf0993a9b69af072075217d261924b9085a2d9ee7105e36079a7813d1862eddfa7727d14e6ce949f83023d84070e0f19e980220d9d5a46f5f0a3d7b533abf60e9deba859c19762ab2ac5bb648b43c2dbdfd87c91333c6a2a91488ab7efd117849b7552ea442a5f47e099458ad74ae02ab028ebe44155fad5693b5e04f8e36b82e4bff5cfa2008077f58b3185e3b775f39befd9248d9d031f29956ccbf3b8a261b3879b41211235521d1efa233235c6a86fe65b40ec7cfd2ba7bbf751c8d55949a8968182dfb984dcf57264e0b393c40b538d4c3940e117a9023e392a6478a0a1636ac56c58b6c09e0ecf5a50cc74c427dda487f14de8baa5f3fadb086f7d14eb73e5abdfd15a4442435f81ee76e34e70c73f9ddb37d70b09f6599863c8e3284b95ad61fbeaad221fa8c479f261b5f10c86865663612",
         "b4ae65e9e683c913ab592d1635b2f225ab9b53b10ab2c00e354846cf0c3a8910f25a4505a266f1680e8e2f3829623b220ec00c659f85d123071c3358b5fd8264307d2e145ce8949c226980eb5ff4940501307bb1f945501eec5c561c2b111c01a3aa407a8df0ac14c9930109aee2d8257dc9b603f67ffa23aedb695a85097d1a",
         4,
         "8ed42492918a86e5fef0063d0159af9fbeb85fb55f6515154ffd0c0374de5e1b21fcdd8fb32c297917b4ccf124bb750f11f2b91a0c47516854ad0dad3d7ce801ded19deb6a7222b58c43b1f569b54a5d903a7c270bc1c3a90f604d7c27cb51008095fe6633c8bfd7f0714cf20014de9c854bdc17d0eee63504249e3e04d2a8fbac9a3c4f65c4f6b438be5aeb937b2f126c4783dcf550868c59b627954c505395c1e316dd237e082f5e2e712db2fd55214578f2c993cb3fb434c752b81d6236169b3f2f30731c9fad762cdf1598b525cbae27fc4b76758b20eb8af6e734a258d590e9b735d6163c02d2c7ee6313446413319a8dc51d8d5132f22153b693561389ee90b9e5740a244295d254fec13e5cdd7bd55998898316797c68fff1bf33d512",
         return_code::success
      },
      {
         "3998df17210f3e814d6bb0e743184f82321f243b9cba7d965dd9ceabc1cdacf54726b994369161906ab8ba10ed94c002fa242b82c4fe9bfc774bc0cedc3be2cc8668a1f5b07f32215b711da58fb14813e94cb97b5f9c1be11b505da863d0fb1894a7247d770687ce86fbfef583763eabc6e12e82073762142631ed576312b0beb07e933adb342c0f9882b20435d05019e13b074112d96c8827504ddba5654591d8001cc233e4648c40b966eab36d3a89d4470e94f0ba505859f447f80c5bf01442430442194b26334273727234d519075dc6a7f2a2782d5e0073ed7171dfef62999deee900bc557378893baad5714712b71668f3957d1bb87736015b4c0ed6ef24ee3647771e6ad913ff55590658427eff01272bb87ab4caa82ce8e5ac967911f19911aea7fb3da3711144c2d18325bcf899c3ba3ff1ebd4d2f6d45082a86233382bbd38b6fd0cbcff6c74d14b4c6a06376bc527211403b4285f1f4dfed47ad8a0494dd93db82d5afc02cf422df7134516d2b00c7c878091184cc20ccbdeeb0b70cc22d4100bfaf1ea8bcb13076da4dda9a60f60f88e7ab1c92956f378a753a13b3489b5a2015f14f41605e970d4da068527342540d6f57bd8892d6fbe8bbafd32e333b6c257ba6fa4073b715b0327b559fa562fcb16a886b3cd8a6d27d96806e3e7efd32ee03e03dc9cd6104175629523e8cc5730a03b5fe2c9176af4b0d73cdd654b81cb14bb44d54b9f0f3b184315978748e0c6a2731bf6d3bedf5088108cdae944ce40fa8b5b09b1458e11ba8fa79007dc043d55a7e99d037fc00eb408195855d8dc4e8376c60f66f55c1a16b11abfd96369d3cde62333aa0cd14d9968ffeb0783a656866d7054d2477150514f0e0435c7a4d0301fe604d03672d41fee5e04f449e949f91409329a3ecdeaaaa27e3ea28d288951dd512a93a94d3d6c910f8a93546f5de500a8690fe70dd59fb69e5d8b29d8cc1b95c47cef278fde33b26f32a6188dba7ed4dafd37cbbe2baea40d955e5f914bbdb31ab81f1dec6bce1ca2247929e3e80b80f086072bd271d21b594e3b789fb5dc873936e78ffa6f449b0e5db21376114aa3cc2da4caaa114b4d1b4cebc09bc1012ca388daf407ded70a05111d502e921f74ab24c9c26f249104046350db0e7ad39fdf033bd0383ae641873f8abfa2e3724e45751cfde59919f63e18feb420f4db75bbe067b8db1ee7a50a147821e50d30ca4f1e9ff54b9ae2df3234d08be1f648c1995c858dacb66e9b476e7175b007c15cbf2b129508e5cf8e029673761fb43796a9af6ebf9a75a950c9bad74d16243b95d7dcc9cbe2670ca6b2f0068d7368c35ded963187955276e1157868b3e02489481540ab9b46ac14b258d96936ee2fac67a655681bc261bf3b5d48e0a483ffd3e9f2231ac516fc8a1c06c5cb68efa822688afb03f823a512a0197b4092009199e8655eca47b0d5fa4af82d03dcaa45259eb3c2a3bc4f37c3f7198679b9ec48fa3dd145359ff0532993aba1ddf7f8d3cca01fcf758b650276d686d3aa04df8f39d4c221822093b15bc70d895a558ac4dab0f558763caecc4e3c15c4dc416988c52ab3320e471d64b446c58d738a31d60942b57ad9cb800ba4330e",
         "cb18d3525c80ec237373be45fee17c2b24c5281f88613721f6285742cff4fa35101fcd043f78c6dd72e754515bccbb1dcc793c6a0dccd71f1e9f1a5e27b534389470eb12e82bd5310c9baa2a8cd9c148f97e641e2f22390453783b158a4606580776c370be1871c4e209b9e84e316e3c459e05f7028690185e76d1bc41f2116d",
         4,
         "13376624734809dd6912bcac5fca9170f7ef6baad99a3b08778cad1687281be060d8f74ef18dc949f90b0a82f71d0319b8af17e762d4477670c6af589382bdb3dee071cab2142a4eb3106a6b58b5e8023005d660a509fa864a3fb2e3a918321391b30e4a928a8742b7747f74680e6536fef8422ecb3fb1a5e7cc3f122bb60df2d4b93d7590442639794070bc01ded2066c71913c94dbe504e3b75b095d7c6097b3770e6ebc9e013e0cc81c4f5fae10db1364b419de2a7be093a8c5b02c88b018e6b99ff21ccea083789ab3e0454d5c36d475a4704db70ee4a53ddf7ea04844219980c2edf17fa408ea53dbd804b76515ff7fe39d3d03d77abbd260f32aaeac89b86c9aa5a1f4f63e25e95d4b9bdbe00338a3a52cebd6541ca7c5486d630cd202",
         return_code::success
      },
   };

   for(const auto& test : tests) {
      auto points = hex2bin(std::get<0>(test));
      auto scalars = hex2bin(std::get<1>(test));
      auto num = std::get<2>(test);
      auto expected_result = hex2bin(std::get<3>(test));
      auto expected_error = std::get<4>(test);

      c.push_action( tester1_account, "testg2wsum"_n, tester1_account, mutable_variant_object()
         ("points", points)
         ("scalars", scalars)
         ("num", num)
         ("res", expected_result)
         ("expected_error", expected_error)
      );
   }

} FC_LOG_AND_RETHROW() }

BOOST_AUTO_TEST_CASE( bls_testpairing ) { try {
   tester c( setup_policy::preactivate_feature_and_new_bios );

   const auto& tester1_account = account_name("tester1");
   c.create_accounts( {tester1_account} );
   c.produce_block();

   const auto& pfm = c.control->get_protocol_feature_manager();
   const auto& d = pfm.get_builtin_digest( builtin_protocol_feature_t::bls_primitives );
   BOOST_REQUIRE( d );

   c.preactivate_protocol_features( {*d} );
   c.produce_block();

   c.set_code( tester1_account, test_contracts::bls_primitives_test_wasm() );
   c.set_abi( tester1_account, test_contracts::bls_primitives_test_abi().data() );
   c.produce_block();

   using test_add = std::tuple<std::string, std::string, uint32_t, std::string, int32_t>;
   const std::vector<test_add> tests = {
        // g1::one, g2::one
         {
            "bbc622db0af03afbef1a7af93fe8556c58ac1b173f3a4ea105b974974f8c68c30faca94f8c63952694d79731a7d3f117e1e7c5462923aa0ce48a88a244c73cd0edb3042ccb18db00f60ad0d595e0f5fce48a1d74ed309ea0f1a0aae381f4b308010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
            "b8bd21c1c85680d4efbb05a82603ac0b77d1e37a640b51b4023b40fad47ae4c65110c52d27050826910a8ff0b2a24a027e2b045d057dace5575d941312f14c3349507fdcbb61dab51ab62099d0d06b59654f2788a0d3ac7d609f7152602be0130128b808865493e189a2ac3bccc93a922cd16051699a426da7d3bd8caa9bfdad1a352edac6cdc98c116e7d7227d5e50cbe795ff05f07a9aaa11dec5c270d373fab992e57ab927426af63a7857e283ecb998bc22bb0d2ac32cc34a72ea0c40606010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
            1,
            "b68917caaa0543a808c53908f694d1b6e7b38de90ce9d83d505ca1ef1b442d2727d7d06831d8b2a7920afc71d8eb50120f17a0ea982a88591d9f43503e94a8f1abaf2e4589f65aafb7923c484540a868883432a5c60e75860b11e5465b1c9a08873ec29e844c1c888cb396933057ffdd541b03a5220eda16b2b3a6728ea678034ce39c6839f20397202d7c5c44bb68134f93193cec215031b17399577a1de5ff1f5b0666bdd8907c61a7651e4e79e0372951505a07fa73c25788db6eb8023519a5aa97b51f1cad1d43d8aabbff4dc319c79a58cafc035218747c2f75daf8f2fb7c00c44da85b129113173d4722f5b201b6b4454062e9ea8ba78c5ca3cadaf7238b47bace5ce561804ae16b8f4b63da4645b8457a93793cbd64a7254f150781019de87ee42682940f3e70a88683d512bb2c3fb7b2434da5dedbb2d0b3fb8487c84da0d5c315bdd69c46fb05d23763f2191aabd5d5c2e12a10b8f002ff681bfd1b2ee0bf619d80d2a795eb22f2aa7b85d5ffb671a70c94809f0dafc5b73ea2fb0657bae23373b4931bc9fa321e8848ef78894e987bff150d7d671aee30b3931ac8c50e0b3b0868effc38bf48cd24b4b811a2995ac2a09122bed9fd9fa0c510a87b10290836ad06c8203397b56a78e9a0c61c77e56ccb4f1bc3d3fcaea7550f3503efe30f2d24f00891cb45620605fcfaa4292687b3a7db7c1c0554a93579e889a121fd8f72649b2402996a084d2381c5043166673b3849e4fd1e7ee4af24aa8ed443f56dfd6b68ffde4435a92cd7a4ac3bc77e1ad0cb728606cf08bf6386e5410f",
            return_code::success
         },

         {
            "0ee342698bb6d96f5862e208f46e02b2f1afe99e975c6cae2f843ef50091e72e6171836ebe8e093c79c718ddda8a3915f2a17975b7174deef1a0cd449a544598028fb9966c4e07d55efca7cbc123ab1b0eac14f5c5143abdadac359f5e0a83150100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001dddf8e5208b9dea3576cea6a4ebafc886e7d49e6ffc7229e9e624c3e5a76907aab2c4eabc486489c90108f5b6cd7e161a54da1d12074d5032690f3b1124bd1b3a4f0772ec2027a901528b77906a3ade7095ff8fffcec018039b0b130cacbc1301000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000097f1e7dd8bc500dab7bee0fa9d6ece17468c80e6cefe99c750c97b3f9fb2d5c705a9a76f6cd3d0dfb98455eb2901b0037819d28e7396ca05f6762cc4199314cafba4d88497f5b1b8d6b2c9757ba7cacf0be30b165c1b267cfd89d5366ae64500010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a806f813beb0f13c06fec0b8fb70eacec12d3c94d5a171f74d90c616d788ad56bc083b1d1ede17eb7adb88c7241c85194d264dcd282abd80390fd9e08270fb9ec01ca19f08fcb167d6c8db813517d85f41d3bf844339ae7c9142f33ae21e5718010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
            "7ee127783617cb4ef58361b4b760b9405bd596a9faadef2977e39acdc4479f4f48b333b7ee8fc5f046e2a1838534d50335caf5935bde4f3912848f869ddaf64a2a5bc96e35b0408de053bb61f9f6af33a1cda5fae130cab5f018d14caa534d172242fd5b249d752ab58d4dc6a75cbb3a70474a5a97bdb5e46e3d318e59528242ad832bb1dab5537134a77e1609d3fb07bb2e511f92b4d7a6ba393003a1b0605a743b9d9fbf51401d184a0dee8483fdb84d4e022ec838924bea2d87bd8b64f816010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000318a2aa7183338d070381cd936c5ed51560b6955eb710c235ef8dd2024e46ee18add02958f5e81cf9b63c76a9579250f73117ab5396fae7951934389c3fa2898aefee684eb091f24e08175b0c7d3f706d10a70d89ac355b41c73fa1fd8b825041788c011a785b7897e7b204863a33aa83bad42f84058de5f86ffe9164365d010af5d6942d04f204db93d3676ea530c1055a614277996f55cfb7ffebf6f1f4e77803c96ad61ddbe8797b15dec6065fc83b206549cb860a90174086465912fd9080100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005caced6097678c80eebf30819f32811653f02b0fffb38c595f3f21698fd7a9149e23ed9443fcd440d1105f74b32549069b424a7d2b39921e1aaeb52c964b88f9e3a62e9af8c2d0250ce5d05aeadd950399d6d76a416fe0ce54939ed7800d47065d65053eec226c31edcaafd8b343f1a7cf91a5ce818331f7ca37fbcfc13cf1d60bfd9294472af7a4cb7b796d1c1b390e7b50fd1bd3e3ba2cbd34eea6f64baab7e847698faf692aa29af20998edeb7633415c65f0e95f5acba7bd5bf4b93cc511010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000da9dd92b16538db8ca15156932138efb27793bf5950bb3b595efa580d2a05e00e932637ad80a88b1a91a7aaff72e6f19c30fcbc7b19e9b6746e18c649f576b80b1365c835f826a76bc55741388a96d98c84be96fe5d958c2a6071c14908f3d0cd68e45e0fb13f4307f665ce5cf5895912dc4cdd59b5653d01de11a23363bbc8b09ce6e3f19ad82afe0a089858f446b1305af6ac0c4e5faf6d7936df6383a82e4a8f647dfa1f40d00745d05bf5e9af76d7341bfcbd21baf6ff7c981a72d08d518010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
            4,
            "6a0a014eafa202e4302849b3fe5f80c8ee22c746ab61627cd7576fcd5b762cd7280042d0ea26d088a0c80622cda76410cb2059a83b7b4fb283727773931b1e209cfea44595b38491559e4f1f8d9839890c1da6e8b7b6cc4952e1458c0e50d313d01175b8cbcff7191cba5938864c804f1fd7f2ad8cb7ab99ae62b05bd8fd0cfb1eebc2a2eb69376529f5358870e73a0bc812dd065c74f5d95330ea20878406379a4b97203db11cdce74532bf8c4b7c2632d3a055371586ee886d22c280bafc17533735f06f551f7e318512a34da546ad00ade5b7567faf2fd5959c8a8048e599eba661ac3bf143cfa2e7c36baa5cf1017c531db1ead9e96e091bf6511b9de5d3c526f120cd6513fc2570a1c77018173a8d36ab92b735abe1160c010a827c1312d63492594733637d982068d93051a646087561d65832369481a10bf63791bb55d8411b3dc20579a73c9240262b3925073a769a55a74fd78e5900edee879cdf0d1b60652321454f87dc981b4b8d49e50d23e4b64eb4ceb47521a617154af1ec03d753fc92c5a42daa64f8933abecbaa71188a9ed03adfe37c6f178229688f0e546fec5c3bc283da3f83fa9ba448a194080efebdc4710154334367493fd9015be51ac6fec460add6ce0e80aec5c65f43379aa95e5bb867fd231e83a700490215104791fabd039a3b209c482fad27ddebdbf616bc16a3454d38ce192edc236de08bb266a74df608c4013a15e6ad1542fd1758589ac22983e14bc9396cdbe737da8acc486b96eb093021d2af944aca1299d7842a90c49eb32ec4f4b1bf3de3b80a15",
            return_code::success
         },
         {
            "24dc1e4565f20fef3f2cbc0d4bbf52857dcfe43a01d762c3f17069d145ca558885b28c4c09d02f932b1837e8e67c8a0e541ce60417524f1f21aef285c9f5a24b37b52cf0d436ed310d23d45900f53ae297610365e2880424e6c1fe616b83651501000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000056dd282484e3a3ee378a862640887806a7ec6c8bb7b761d96dcee583879c94eee4d9fc522931d13531da3be4f9fd421469a0d52add6a2469619f375fb253478a9f8bde27ed5596a3301a00b297607698c3d01ec22c60aae66cf274a3de1a480e01000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000082b4ddba8598df3c1cd5882beda98ed0565189b772442aafad93ff44e482a2ee8eb2ce469fc861d5eaceeba136e5af068fa30be80dc5ae11d0b91eab46c31ce51a76716d3b5ed52904e93b9e0773120188e02bf2f254e7411fc22b2967bf9405010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000d856767795acd88b4d2036af32411a46f86e3164c1d3d7c5957de95ee65cec2c630e5e2c61a0fe85bf754c28c50d4f16102b8a7e881d646f4305862b2a545104eab522a2436e3bf0d27c9f6b63b8f92224ea1226a6dd1bce94a2514edb2df018010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
            "f52e9ed1085833f6833969804dff5becc53bc2ea6ed36e79fcc66aa1cf8305c2ea7eda94e5763477187f858e73ab43192aa512004c7d391c0fdb759f4312ee2e0c9b5e2e8822953b9da5c249750ed4879ae401126fa97e96ddbec247e7ae2402d6db4d7f8c09fdae0e725223ac225e1dd67abf82251221b341152f354ded1289eab076f4e6913035c46d17aa47a2ac0772ca37ae31f56cfc9072598da0b3c09a61122398a1a19566a6e530e8b22e1c17972a3bf5ebe3c21d973404452cd7cf100100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002cc290b2c5ea9270cb4cde570ad78bf9511425bf1a52722f1f334f8432e6fd5b4625dfce407d6acf5d399a26eb0c52144b94b35b81545b6318fafd796adc69650e1488087b2376c911c7db160fdfabe4a7828807baff5d99b63fc772f1542d0391916e77d1bff44a4a4bc3b0428a57c71730dea6ae556e1f16a450c9188b0e9d21713990b9a4a3eae42549a90c7a421538deaaf4c5c5f08394f969adfcd3dcf19df8095c91288694d68ec54089861308aa476ff186de9b4ff9f663d030824502010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ac0a7da30ea2219fda60a92fad492f043f3bad3672047826a49f2a155d39fb4060e0dad7b09a27f4e13a9c0fab351e02d8ed9bb6a7ca158a93a2d8f92c161eef2d044bc97f632ef611cc410e32c4211b666312f3a149d322214b226715324b11537fc75a01c59e103d5c04cbf9edc25713a659742d8b8ea2b2313c277cd7c855bdfff230bbece263ffcce222a20a370ee2cfea8b543f94f758f98d3c0874d497def5cf4602fccc8edcda8c164b49379d8ab67b622902e253f35eb81c2d641503010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000bff971704983937d030eb335273dc92413925720b38782fa91158d8dc620a4e96545d3f3a061a11d6d7d7ae7da860c0bd6194f5958961d8362c7dfa0a2786bfb08c3f55a418834508d0d9af6dd0cd480802c2814a31f0df6861de3f2def3f50e9c71b9534fd269bb6e4e8c4e27f7fecffb7bf8a0f21e4d4a3fea63e62f45893f0b45220f9c1a0a0a9249f9aca00266018090884674705d336768b7e203c6972d1a967dbd1c746fe59c3d1a26ff9dab3b4b0e20fddbc1ad7da7410629b6f0b90a010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
            4,
            "cf7baf3beb19b125ce001f992f6a669e3e6f3c1426ac2d670cdb57a1c403cf5b65bd6a939cdee21cce293d94505ea30b7828f77a90f659915676dad107d1deca01cf756174883a7c52c14726ce8730b6b46ac6877864c55d15c092f7653f0102cfe127bb55f78ac87b0ba94c074a406a08b0bcc897ca5f00cbdc971b53ce704a924268cd4b8ee5d83ee2d9a2205dd901f3eff15bd7e1423da14e403cf950250d4c25dc2d3afd3595531cfc3057dda7f90cd6314f07814ae1f13e8e8ad4eae208e0c21ac198841d5401b88c08330fca019d81ba04139c47ebdfe2c945fe791a74a8a298dd5cb9b5dbb4f83680d78f9e070caad15878a1e472cd912c262f1aa78b5bb6f912602c0cb04b20450a74e1d4bf555b49e901b7acc86b6b87406393f903b8bc3c520a28783cfe9c79b496a7ae25af34e74672cd350bfdb5b5a9f46cb512bc0aa5f8c7dc125cccfa291069b44f15bad29e3e2efa2ff1792633f05f345f1b9066a3f9f67d90001140cc320ae80588ecb0b3eb60c6fb3dc9b434d0bfbed102afb2ee44b999c596699e19df082b6aa5aff6e1d63428a6f48c6a8217a970cae2d8438505b94243215649cf42ebc0d507079603121a5e817d026435752be29e7826e2116bbe046d6d620e9b5ca859761ecde89a1c7f01626fa0e4041e7c6a7e040e843021611332949d27d9cec02ff2b250ddee34cf583e98c45a246d289ab19a55023078a25dec107f055adaebf917046c3945631217d27b5feb6effc011e5093835c235766ac77f9e17b28cd628e062493024247dde36ed30fc71f97d0ead0d",
            return_code::success
         },
         {
            "0d4b4e3c9ac607be0765f747a2120ef024302483a8b8e85923bf02ee61e1add2c1e9bafe998b4bc96a94679bc59be100e965ef2569abdd63ae9e1048ee3fcc18cdedc82fe29b963765490885a1dff567468c17d3ec0d764c5f3c5e8aeff9c501010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ab8382a94b79513a12e2c32355092e2459d5dd4ed1add96999eac8b01807f71869dfa0241162df48a5e27b817063db09a85d39713d77ca8b3e2e31e5bde3d01b4e60d0a1fe6f3c8a34ddc352f020367122417b8b5d51adaded5fac0a8c811410010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e876d70b27c073ef9b5e96dab271381a8389c76fc952597b0487cc9770ef24bfeaf9c24c56063cde22401c25460531130e8844a053fe29fa5193d7e29d28c1a36f0c28cb30f9c4b66ab1a897cf9dbe1ee95ec38ac703878e7290aaf7777c1a0e010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c972a0f98fbfe7a8388a9c540d9c4e995bb01f544655e544b352cca1be6ec12d72fed8d48282ea5097db260a54b1a30daf1a03f8505c4bd0b5d146525570f6936f6cb79085fcbc691fda7482f7fc5eb2d66c6621344fa164647575f4de665818010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
            "e4754d08ccee74a9caa97207df25d9ab389cf419edca9f09824d96a41eff4bddbfca8501a9b88f349f732c4689255f0d8c080aed63f33ca3e584abfffb9da0cb066f2fdbb55b1a74486ca8ac1d2743e0e5e4a1e2d3e7fc2f06b8519b2903711143bc4f83c4d492b69d9717667eb90d195550608509068f2df97a2100a380642d20166c5ea2eaf9cd2a3137ccd9beda13d3eaa6fc235ff83bc54d1b28ae2822e0f07d600bf7d670558cf42459377dd91593f5d2bf6c0ab9f0b445749cf3822c15010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000db6d4bb841ca516a01e631aa9d583d1b086cabe53c5ba89b07818d74a2bbebc613dc711a12e7469274291ba8d74eff1699b07b6022d428c10b0d99a2b4cc68b73b8998e21319e7db981d35b9ea5cb5339d6c324c659f02501f5fc1d373750f0d7e5c6bae1659a142fefb2ab51cff11b56cc055ad49288f0f224d64d45f03ec98c514fc58fcdd124c420c5dd6d170bf1927ea611da29ce1b634fc1e5923c3b187d8b102cef09d9f3b6dc178778bdc1a73e0aab16f87717608ca46f3c44f48830a0100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007a467036d6400b4f875e8c2a2635bbd3e49edbe95007184238205550acfffe1745e38dce7df8f10d790cdb6d0877cf071ead2b5581c7f58bff436ee1dbcf34fc482f8a45b9b2e3198c8e8d67930d889a24b8a2c6bee1d1d81a2a9b3dfc10e50f2ac51f1178908d5a8520f0cc36df2bbba4a74d6868980d160b35da0ebe7d4dca4c75655fb77ae3dd37680405af9f460c490d591876bc42dfe6d431bdba52f5a5376cc85c1f1bdf10cc30c78fdee777cf802a1a364810d91a40f18ee74df1260e0100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000009c70ff37f672c48417e54ec20922b56de3a0911129f1a834d940cb8dca8829141dcd4c7dcd054f193a181c01b24ddc0af3474d1163b2478de2c7fb3824161d0ea29fd57a2b8bde34aa2417ac84176824a0490208585b9c5a678da865f17b56106576d239c5ec25b93114ddf0a91241093cd3ab8cea9f700517f657a18c3d505f17a15a2713551e8c578122c6dab61d19436094f7618e6976ea886b49710db5f40abcd0b4b4ca386e1e74b5900946ea0d62ef1912213b224c457eed8ce74ec80f010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
            4,
            "286c55106bf4aadd45598d0d637e267bc5e94e8f550eb3e9b0d887f339dfe858925f0e804e781f2e0c04e897925f6d018bd6e5739eb2ad1a44f66eb306cf32b73a077f995da743a0c7a4dfca53f5dd9c70ef8a36a811ef1839690ea85a562d013d7ea5b85705fa3bc27fbc72b947d848b2ad9449cdd47413c97eecbcc657e79b0c883cd68734060273b1ecf2c747140c4d8d1aea519825589bf14af8c91af46f5219489dac184de82d87a466fe2d24d003916e4b0b6cd97a3b4c9aa4d93fa118c834ee64eda0d65578fb28afad20d6f0ba21d93ff2c027f1e8895646fec77e2bc63084a032f4a5cdf8c7b9d0e5abd80f850543f787be24559f93dede27f2a95e48f378c73a4d22d38e013a6fec2858e100f1b7290f17d82d88e21690a2454716454db66268274763175c8c38b1f864024a7e9e0c3c5564b16a7c90125844502acc28eecfddaa148a9502c2f10f506213fa07113ecf0e25e311625a97b4c3ed045d957d7f7a6dd886eb86f6b8bb73a6eec2790d4256b77405aac4056744215d06e4bc1e963f777865900a62c9f1794ed060dbf12c7caf6d377c6e6aacffb3cec18cdf0b3a3686f6be7193bb84da0e9306fce8497146c2520e9c3a1b0e0118558d096d07d967d6cfd1c1247e90fd734c8ee3b678003b9764b776df0717706fcf011866637e31a84866e091c16ab04f9be3d1c33e0c19e513de3054e0b69566c559c988a748f930a9067b8be8e5cf6ebf09fb20a210c411dcd69772e9c314bbcb2dc84f51a58043408f69a4082185c32f42486d72b00c672b96276e2fe7044e7307",
            return_code::success
         },

        //test (three invalid g1 and g2 points, should fail)
        {
            "ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff",
            "ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff",
            3,
            "000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
            return_code::failure
        },
   };

   for(const auto& test : tests) {
      auto g1_points = hex2bin(std::get<0>(test));
      auto g2_points = hex2bin(std::get<1>(test));
      auto num = std::get<2>(test);
      auto expected_result = hex2bin(std::get<3>(test));
      auto expected_error = std::get<4>(test);

      c.push_action( tester1_account, "testpairing"_n, tester1_account, mutable_variant_object()
         ("g1_points", g1_points)
         ("g2_points", g2_points)
         ("num", num)
         ("res", expected_result)
         ("expected_error", expected_error)
      );
   }

} FC_LOG_AND_RETHROW() }

BOOST_AUTO_TEST_CASE( bls_testg1map ) { try {
   tester c( setup_policy::preactivate_feature_and_new_bios );

   const auto& tester1_account = account_name("tester1");
   c.create_accounts( {tester1_account} );
   c.produce_block();

   const auto& pfm = c.control->get_protocol_feature_manager();
   const auto& d = pfm.get_builtin_digest( builtin_protocol_feature_t::bls_primitives );
   BOOST_REQUIRE( d );

   c.preactivate_protocol_features( {*d} );
   c.produce_block();

   c.set_code( tester1_account, test_contracts::bls_primitives_test_wasm() );
   c.set_abi( tester1_account, test_contracts::bls_primitives_test_abi().data() );
   c.produce_block();

   using test_add = std::tuple<std::string, std::string, int32_t>;
   const std::vector<test_add> tests = {
      //test (valid field element) 
      {
         "000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
         "c4eeedff9d75fa9b8fd2dd02d763e6da336b8a0cd5c7164c5dffadb719735838b794b1ade1cd180b96c668208f8dfb00ecae7875aaca56ec495d92aa34bc52d9322bc310eea68f0c31d1af89a5d02a9c678c72e38737bdb773c7780d91f06205687481c64b51db898dae924db9c925889c3982512d6ed2fff5603695e0f02d95fbc6906a9eaeec6e073f9a39b318c206",
         return_code::success
      },
      {
         "6de1c03023f2b4e454559b97266ebc1f96cd5510c4f48e2acafbe73a536a1477f2c8d1c9b5f6615d01968ea59ef4fd07",
         "e0a482315373675926a671cf7b6713e386be3a0b9daff70aff0c00280d9cc89cb71b11348e1dc9287d0e0c8ba0ff880935d6d7f42bea93a3aeb042b25eb8032cea0398c21be52eeefca4e303e9851fb511358e1e2924a68cc82009b4114c8800ceb889478e18ab51d4c202caea0db6dec07103307e95b55fe40f02fd441bc64cd7a352daf77de4b8ee643c26bd941c13",
         return_code::success
      },
      {
         "d2e51018d97c13b16f9ad81abb6197f8368434b501c6f8b2d690fef722d806f49cb469d61f4bed69a124f8db3aab7512",
         "2e324e790bf2eaed08c841facb268ad531db92785f8673478dff9943691d87eefbb2dea440106ba077903accdb0636033cfeec3c71157ec44b48db4d02ed7a027c705425f2ca27e9ecbb4ae71d019c841c90b616fce8ce93f96ba488a1f0be088014a79ae95bfcb2321d7c164bc8bae45c69703ad22eb90446841b5a7b64221d72c66a3be502380e6113fb79b73a2a14",
         return_code::success
      },
      {
         "094956e84809a27f467de542a0149629866eb5b9ec353e267b0bef3e0836effe055c6f85278857b8846dde301dd1930e",
         "9f97704a2c4f6b91a6b54d10dbde430d68ab991136d825fa637757fbac7fb3a6c957e22bb33fde456ff0173c5e37530c04da881b4cab754d3635628d8897b1eb0edfa4f42f96e8f9d9508de9c8e4e84997f49e00dd5e1714e2acaeb51e0d9110ab5a6e6aa0dfe302b69e8d98e340e41bd5b4ffe001104bd7cf70fb9f7166fdcf0b4a9159add28f694124bcaca527f817",
         return_code::success
      },
      {
         "3a1acb866b91c2cb46858c70509b9789363b34479bbd65e216c9d91c52512a63464decd8e60bd27470d1551148415a01",
         "210606d6d1c43825ed042049b2e194cf699c5846a29693a1bb9aab1cfd75561e2a76c29b16d2b4f5d19d9dbfb128ee17e33ffe21e4c8c8be42bb756daacf8d5b1bb0c9491c417791b22e76ff8b70a3f4593de13a60dc89e33726fd5f4885c3170fb43004347c5be08adf622325a7251d9f0f1159769ebec8a0db1a6df5d95c166be6d7d8c112ce6d64457ddb4ce6bf16",
         return_code::success
      },

      //test (invalid field element, should fail)
      {
         "ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff",
         "000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
         return_code::failure
      },
   };

   for(const auto& test : tests) {
      auto e = hex2bin(std::get<0>(test));
      auto expected_result = hex2bin(std::get<1>(test));
      auto expected_error = std::get<2>(test);

      c.push_action( tester1_account, "testg1map"_n, tester1_account, mutable_variant_object()
         ("e", e)
         ("res", expected_result)
         ("expected_error", expected_error)
      );
   }

} FC_LOG_AND_RETHROW() }

BOOST_AUTO_TEST_CASE( bls_testg2map ) { try {
   tester c( setup_policy::preactivate_feature_and_new_bios );

   const auto& tester1_account = account_name("tester1");
   c.create_accounts( {tester1_account} );
   c.produce_block();

   const auto& pfm = c.control->get_protocol_feature_manager();
   const auto& d = pfm.get_builtin_digest( builtin_protocol_feature_t::bls_primitives );
   BOOST_REQUIRE( d );

   c.preactivate_protocol_features( {*d} );
   c.produce_block();

   c.set_code( tester1_account, test_contracts::bls_primitives_test_wasm() );
   c.set_abi( tester1_account, test_contracts::bls_primitives_test_abi().data() );
   c.produce_block();

   using test_add = std::tuple<std::string, std::string, int32_t>;
   const std::vector<test_add> tests = {
      //test (valid field element)     
      {
         "000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
         "2cc320eb83394cab86cfcb2aca98ee59c89adc82a2ffe8c4fcd240bc065aa174a5beb4712d6858743395b9ca92403419dffd1c5ba35a4adcb76ce228e7b3811c79f7c7176a9bd2bebf0b69a2f6748e0026a111265c5f41f86ff25aa9c4603207d4fa8db63db7c467ac4b745e4772b2126cbf2b8b39d1e86f48b4226cd6e858ca41e9683208831680f4c541b8d69810138c08a55c4de86d52e6c81cb10a89c8a09076792a4e923f0642600b11f3d66359100cffacb11cc67db3c1aeeb0dfc98143aaac9a85894082ac034829392dfc109df5a4e5e60834a2b77b4b137f33987cb2144463019d81245b08de156352b8a13c25e15d1288382ba2ec9832dcc21ba0ea56f6d2864ee902ccaa4b363edf438326aaef5d934d81f86c2dc2581b0eaa111",
         return_code::success
      },
      {
         "1449dbb73bbcb48b3b752e02dfa0edb5ede9419d8b601d3caf6d4298447b1db2fad35b44e4203eb885f3ad27785d770eca5e3e2d0530cf2d49254ead13700b8277167500205e7f30efce24ae70d4b1fb160aa7ca820ce7b767a21b7107bc5f02",
         "e84dd939150d71b3b43d46434f7f1f77a0e0c61c8110ed5cffd98289f2d81146d8d59f0e9b16dcb774d9cd65ffd81b00992d503294aaef09fdd3af0daf143d3bbb0032606e07655fbb5f460ae0e46883b008c7227174609201df62fbaf8ba207df50029d418e33954690de92c5b8ac306523a11e782d2c55678b787fae3d52f286aed0fd5ffa083fc5e1d1a1ac704908b8eaa5c7ed9a5b3d6434932a5804cf9903d09f0b1fdfc7d730a1421d3231f505205e4bbd65e73140205767a1cf3ef719a3913387a3e9ea4402fb28036d44884bd7404fcf4f939a2a12191ecc910682a4b86624fd1c77958de393800e81c757190f96bb7123c76a549b6df5a035feb584164e88031d89451516f9b4a085e71cd91b442e72d8bfee79b61f36f3363c3309",
         return_code::success
      },
      {
         "db4f64b6ead6e1a545fc454e24f0ee0cc9335ee6ee1b8eb70550c8d32312cd663a064fb651284b7cbaa8b5e41cb35a04cbbd1c96af164e0a97ce331daacd180ff7d3308d364aa956799902525dbf4180590fb246355a0174eb1d2afddba77018",
         "cfbdbf3b9a0ba68429054cad7effe4343d9d559e2c8433515b54f59442ade90df79c19280b0e9268a8a3d7221f6df606ce984a0737b381d10af7af93cc231de97ed6de5ba4a3e42f3d6ddd997a0e989db4e3a945bd19ef7ba0e2da377ddef40eb2f45ce6da09cfc2af45d299e368d4ba819d10f98a3275bb2438a733f4050cba51770b4fbc4b9124595d318e3042850e31228e8d3e09cbe9340a4837311f4a788c8f74c354096f195a19555d7fa6329b04bad93126fdd3b94874bf7993495809df0b7da1214ea8807b3911e1aca7f1f2158153d04386f3d47d47df7dcb1b4b1a8915f125936a64a009f3a6c0070e81167c30f706c396c5eb6eb86120d4e8ea3c961016afa082c18ed86ff426d193755c7e3ab39735911a93b2c015619319e510",
         return_code::success
      },
      {
         "b4108d552274d175fd4e52dd766ff396a4f365c102e0ef7b4d266f220ec67eefab48ac15d1db0d98ba31cda435616e0bdeb51952b044ce0f64b5d42199d9560ed0175f3d2c58af07909d29db4480c1b417dfbf7f1af274648adb54b029e38f08",
         "5fb1388da7918ccd909f866d15e0211a82048237e02d977f20543ac40ac93de2ccff2211ea443aefd839a5b1e9518b0eb8e639157aaff319ef48a1b47d764b10711615230dffc2c6740b382a0ef25a751ec8fd98d2f44161bbe10f0fae62cd1962caf7d08ca08638403fc28094e46143a23aff4238cfbe85a893fd5cf339fbf241880136dfe3160e74faf6349dee7106ba97a567e770f6ef6e3ee2571d958ea7ce323506808d015d3d1fa22b41027fc57b247a89bbf85e87bc4bab5fd78fc103844e484f2c5cf3ebf62015b6d4390058a017c5cd072240acbaf0d962da5beefd9b574359427071ded658cfa878defd14fc42998afa44557c7370903ed6b34513790e586950c1488155a4fa162462ca098e4016c3c403ba386d0d8d2435e44014",
         return_code::success
      },
      {
         "7e4dda81ee149d8b6b43a1a89c6f80d07b5fa93bff73215bd3c8677c671348b477a8912deba95a298574d64706b5450fb6fb07b9be96d4b87d677eeab47bc473ad7dc44c286b9e63b949ac64fb5b56e09638f48847238c18c1e4056aa616df03",
         "0747e844852618f18f528be3267dc11c728c2b0b7f6fddfc240971949c5903147cdb2e5791851f792c5822237793921053736a50d7719c2421dd58ae2c26aed85f8330123c395b6e18dd760327240b875de65237c33e341afc5b877398e81518cd827ebcfd2083756ef1e4150d8276bbc2025c8c01bcff1fc24f57090a34211d62d50b7d5df29a3eeaadb10d0db91919cb03f8fde38e858599d3e3a01670a1ac4d11f9b2eeaa3d109e4fac1e9707f420fe34bb97efd94ad874150b9a5f512719e2bfcb1784b834b17f33552846bf6f8edb4817764a9fede0f29806484f0270ec612752f967a095bd94137d0402384900d40f85d23b50c35994ff0b7268e89f207cb9fcc786d944e522571ec86b621bb96cea8fd6519c623c54a210c23ad66400",
         return_code::success
      },
      //test (invalid field element, should fail)
      {
         "ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff",
         "000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
         return_code::failure
      },
   };

   for(const auto& test : tests) {
      auto e = hex2bin(std::get<0>(test));
      auto expected_result = hex2bin(std::get<1>(test));
      auto expected_error = std::get<2>(test);

      c.push_action( tester1_account, "testg2map"_n, tester1_account, mutable_variant_object()
         ("e", e)
         ("res", expected_result)
         ("expected_error", expected_error)
      );
   }

} FC_LOG_AND_RETHROW() }

BOOST_AUTO_TEST_CASE( bls_empty ) { try {
   tester c( setup_policy::preactivate_feature_and_new_bios );

   const auto& tester1_account = account_name("tester1");
   c.create_accounts( {tester1_account} );
   c.produce_block();

   const auto& pfm = c.control->get_protocol_feature_manager();
   const auto& d = pfm.get_builtin_digest( builtin_protocol_feature_t::bls_primitives );
   BOOST_REQUIRE( d );

   c.preactivate_protocol_features( {*d} );
   c.produce_block();

   c.set_code( tester1_account, test_contracts::bls_primitives_test_wasm() );
   c.set_abi( tester1_account, test_contracts::bls_primitives_test_abi().data() );
   c.produce_block();

   //expected return is g1::zero(), which is x=0, y=1, z=0. 1 here means fp::R1
   c.push_action( tester1_account, "testg1wsum"_n, tester1_account, mutable_variant_object()
      ("points", std::vector<char>())
      ("scalars", std::vector<char>())
      ("num", 0)
      ("res", hex2bin("000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"))
      ("expected_error", (int32_t)return_code::success)
   );

   //expected return is g2::zero(), which is x=0, y=1, z=0. 1 here means fb2::one(), {fp::R1, 0}
   c.push_action( tester1_account, "testg2wsum"_n, tester1_account, mutable_variant_object()
      ("points", std::vector<char>())
      ("scalars", std::vector<char>())
      ("num", 0)
      ("res", hex2bin("000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"))
      ("expected_error", (int32_t)return_code::success)
   );

   //expected return is fp12::one(), which is {fp6::one(), fp6::zero()}, which is {{fp2::one(), fp2::zero(), fp2::zero()}, {fp2::zero(), fp2::zero(), fp2::zero()}}
   c.push_action( tester1_account, "testpairing"_n, tester1_account, mutable_variant_object()
      ("g1_points", std::vector<char>())
      ("g2_points", std::vector<char>())
      ("num", 0)
      ("res", hex2bin("010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"))
      ("expected_error", (int32_t)return_code::success)
   );

} FC_LOG_AND_RETHROW() }

BOOST_AUTO_TEST_SUITE_END()
